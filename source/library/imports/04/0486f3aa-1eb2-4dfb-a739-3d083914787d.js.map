{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.js"],"names":["cc","_decorator","ccclass","property","NewScript","Prefab","Node","Label","AudioClip","Sprite","heart_1","enabled","lifeStatus","heart_2","heart_3","heart_4","heart_5","groundY","ground","y","height","currentStar","currentStarX","timer","starDuration","isRunning","starPool","NodePool","scorePool","lifeCount","menu_screen","resetScore","btnNode","setPositionX","btnNodeHelp","btnNodeStore","gameOverNode","active","player","startMoveAt","p","spawnNewStar","gameOver","newStar","size","get","instantiate","starPrefab","node","addChild","setPosition","getNewStarPosition","getComponent","init","startTimer","star","put","minStarDuration","random0To1","maxStarDuration","getCenterPos","x","randomMinus1To1","topBeginning","pos","op","score","despawnStar","audioEngine","playEffect","cryAudio","parseInt","scoreDisplay","string","toString","fx","spawnScoreFX","play","scoreAudio","step","setHeartIcon","scoreFXPrefab","scoreFX","dt","position","split","spriteFrame","type","gainScore","getPosition","stopMove","destroy","Component"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import Player from \"./Player\";\r\nimport ScoreFX from \"./ScoreFX\";\r\nimport Star from \"./Star\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewScript extends cc.Component {\r\n   \r\n    @property(cc.Prefab)\r\n    starPrefab = null;\r\n        \r\n    /**\r\n     * @type {cc.Prefab}\r\n     */\r\n    @property(cc.Prefab)\r\n    scoreFXPrefab = null;   \r\n            \r\n   \r\n    @property\r\n    maxStarDuration = 0;\r\n\r\n    @property\r\n    minStarDuration = 0;\r\n\r\n    \r\n    @property(cc.Node)\r\n    ground = null;\r\n    \r\n    \r\n    /**\r\n     * @type {Player}\r\n     */\r\n    @property(Player)\r\n    player = null;\r\n\r\n    \r\n    @property(cc.Label)\r\n    scoreDisplay = null;\r\n    \r\n    \r\n    @property(cc.AudioClip)\r\n    scoreAudio = null;\r\n    @property(cc.AudioClip)\r\n    cryAudio = null;\r\n    \r\n    @property(cc.Node)\r\n    btnNode = null;\r\n    @property(cc.Sprite)\r\n    btnNodeStore = null;\r\n    @property(cc.Sprite)\r\n    btnNodeHelp = null;\r\n\r\n    @property(cc.Node)\r\n    gameOverNode = null;\r\n\r\n    @property\r\n    topBeginning = 0;\r\n\r\n    @property\r\n    totalTime = 0;\r\n\r\n    @property\r\n    step = 5;\r\n\r\n    @property(cc.Sprite)\r\n    heart_1 = null;\r\n    @property(cc.Sprite)\r\n    heart_2 = null;\r\n    @property(cc.Sprite)\r\n    heart_3 = null;\r\n    @property(cc.Sprite)\r\n    heart_4 = null;\r\n    @property(cc.Sprite)\r\n    heart_5 = null;\r\n\r\n    @property(cc.Sprite)\r\n    menu_screen = null;\r\n    @property(cc.Sprite)\r\n    gameplay_screen = null;\r\n    \r\n\r\n    // use this for initialization\r\n    \r\n    setHeartIcon () {\r\n        this.heart_1.enabled = this.lifeStatus[0];\r\n        this.heart_2.enabled = this.lifeStatus[1];\r\n        this.heart_3.enabled = this.lifeStatus[2];\r\n        this.heart_4.enabled = this.lifeStatus[3];\r\n        this.heart_5.enabled = this.lifeStatus[4];\r\n    }\r\n\r\n    onLoad () {\r\n        \r\n        this.groundY = this.ground.y + this.ground.height/2;\r\n        \r\n        // store last star's x position\r\n        this.currentStar = null;\r\n        this.currentStarX = 0;\r\n\r\n        \r\n        this.timer = 0;\r\n        this.starDuration = 0;\r\n\r\n        // is showing menu or running game\r\n        this.isRunning = false;\r\n\r\n        // initialize star and score pool\r\n        this.starPool = new cc.NodePool('Star');\r\n        this.scorePool = new cc.NodePool('ScoreFX');\r\n        this.lifeStatus = [true, true, true, true, true];\r\n        this.lifeCount = 5;\r\n\r\n    }\r\n\r\n    onStartGame () {\r\n        this.menu_screen.enabled = false;\r\n        this.resetScore();\r\n        \r\n        this.isRunning = true;\r\n\r\n        this.btnNode.setPositionX(3000);\r\n        this.btnNodeHelp.enabled = false;\r\n        this.btnNodeStore.enabled = false;\r\n\r\n        this.gameOverNode.active = false;\r\n        this.player.enabled = true;\r\n        this.player.startMoveAt(cc.p(0, this.groundY));   \r\n        \r\n        this.starPool = new cc.NodePool('Star');\r\n        this.scorePool = new cc.NodePool('ScoreFX');\r\n\r\n        this.spawnNewStar();\r\n    }\r\n\r\n\r\n    spawnNewStar () {\r\n        if (this.lifeCount < 1) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n        var newStar = null;\r\n        if (this.starPool.size() > 0) {\r\n            newStar = this.starPool.get(this); // this will be passed to Star's reuse method\r\n        } else {\r\n            newStar = cc.instantiate(this.starPrefab);\r\n        }\r\n        \r\n        this.node.addChild(newStar);\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        newStar.getComponent(Star).init(this);\r\n        this.startTimer();\r\n        \r\n        // Set star with new sprite;\r\n        this.currentStar = newStar;\r\n    }\r\n\r\n    despawnStar (star) {\r\n        this.starPool.put(star);\r\n        if (this.lifeCount < 1) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n        this.spawnNewStar();\r\n    }\r\n\r\n    startTimer () {\r\n        // get a life duration for next star\r\n        this.starDuration = this.minStarDuration + cc.random0To1() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n    }   \r\n\r\n    getNewStarPosition () {\r\n\r\n        return cc.p(this.player.getCenterPos().x + (cc.randomMinus1To1()) * 250, this.topBeginning);\r\n    }\r\n\r\n\r\n    gainScore (pos, op, score) {\r\n        this.despawnStar(this.currentStar);\r\n\r\n        if (op < 1) {\r\n            cc.audioEngine.playEffect(this.cryAudio, false);\r\n            this.lifeCount --;\r\n            this.lifeStatus[this.lifeCount] = false;\r\n            return;\r\n        }\r\n\r\n        if (this.lifeCount < 1) {\r\n            this.gameOver();\r\n            return;\r\n        }\r\n        this.score += parseInt(score);\r\n        this.scoreDisplay.string = this.score.toString();\r\n\r\n        var fx = this.spawnScoreFX();\r\n        this.node.addChild(fx.node);\r\n        fx.node.setPosition(pos);\r\n        fx.play();\r\n\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n        this.step = this.step * 1.001;\r\n    }\r\n\r\n    resetScore () {\r\n        this.score = 0;\r\n        this.scoreDisplay.string = this.score.toString();\r\n        this.lifeStatus = [true, true, true, true, true];\r\n        this.lifeCount = 5;\r\n        this.setHeartIcon();\r\n    }\r\n\r\n    spawnScoreFX () {\r\n        var fx;\r\n        if (this.scorePool.size() > 0) {\r\n            fx = this.scorePool.get();\r\n            return fx.getComponent(ScoreFX);\r\n        } else {\r\n            fx = cc.instantiate(this.scoreFXPrefab).getComponent(ScoreFX);\r\n            fx.init(this);\r\n            return fx;\r\n        }\r\n    }\r\n\r\n    despawnScoreFX (scoreFX) {\r\n        this.scorePool.put(scoreFX);\r\n    }\r\n\r\n    // called every frame\r\n    update (dt) {\r\n        if (!this.isRunning) return;\r\n        \r\n        if (this.currentStar.position.y <= this.groundY) {\r\n            let split = this.currentStar.getComponent(cc.Sprite).spriteFrame['_name'].split('_');\r\n            let type = split[0];\r\n            // let score = split[2];\r\n            \r\n            let score = '1';\r\n\r\n            let op = 1;\r\n            if (type == '1') op = -1;\r\n\r\n            this.gainScore(this.currentStar.getPosition(), op, score);\r\n            \r\n            this.setHeartIcon();\r\n            if (this.lifeCount <= 0) return;\r\n            if (op < 1) return;\r\n            \r\n            this.despawnStar(this.currentStar);\r\n        }\r\n        this.timer += dt;\r\n    }\r\n\r\n    gameOver () {\r\n        this.gameOverNode.active = true;\r\n        this.player.enabled = false;\r\n        this.player.stopMove();\r\n        this.currentStar.destroy();\r\n        this.isRunning = false;\r\n        this.btnNode.setPositionX(0);\r\n        this.btnNodeHelp.enabled = true;\r\n        this.btnNodeStore.enabled = true;\r\n    }\r\n\r\n}\r\n"]}